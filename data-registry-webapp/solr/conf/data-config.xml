<?xml version="1.0" encoding="UTF-8"?>
<dataConfig>
    <dataSource name="registry-ds"
                type="JdbcDataSource"
                driver="org.postgresql.Driver"
                url="jdbc:postgresql://localhost/registry"
                user="registry"
                password="registry"
                readOnly="true"
                autoCommit="false"
                transactionIsolation="TRANSACTION_READ_COMMITTED"
                holdability="CLOSE_CURSORS_AT_COMMIT"/>

    <document name="collections">
        <entity name="subject" dataSource="registry-ds"
                query="SELECT * FROM subject WHERE isactive = true">
        </entity>
        <entity name="collection" dataSource="registry-ds"
                query="SELECT id, atomicnumber, published_id FROM collection WHERE isactive = true AND published_id is not null">
            <field column="id" name="id"/>
            <field column="atomicnumber" name="atomicnumber"/>
            <entity name="collectionversion" dataSource="registry-ds"
                    query="SELECT title, description, type, id FROM collectionversion WHERE id=${collection.published_id}">
                <field column="title" name="title"/>
                <field column="description" name="description"/>
                <field column="type" name="type"/>
                <entity name="collections_subjects" dataSource="registry-ds"
                        query="SELECT * FROM collections_subjects WHERE collectionversion_id=${collectionversion.id}">
                    <entity name="collectionsubjects" dataSource="registry-ds"
                            query="SELECT label, term FROM subject WHERE id=${collections_subjects.subjects_id} AND label != 'keyword'">
                        <field column="label" name="subjectlabel"/>
                        <field column="term" name="subjectterm"/>
                    </entity>
                    <entity name="collectionkeywords" dataSource="registry-ds"
                            query="SELECT term FROM subject WHERE id=${collections_subjects.subjects_id} AND label = 'keyword'">
                        <field column="term" name="subjectkeyword"/>
                    </entity>
                </entity>
            </entity>
        </entity>

        <entity name="agent" dataSource="registry-ds"
                query="SELECT id, atomicnumber, published_id FROM agent WHERE isactive = true AND published_id is not null">
            <field column="id" name="id"/>
            <field column="atomicnumber" name="atomicnumber"/>
            <entity name="agentversion" dataSource="registry-ds"
                    query="SELECT title, description, type, id FROM agentversion WHERE id=${agent.published_id}">
                <field column="title" name="title"/>
                <field column="description" name="description"/>
                <field column="type" name="type"/>
                <entity name="agents_subjects" dataSource="registry-ds"
                        query="SELECT * FROM agents_subjects WHERE agentversion_id=${agentversion.id}">
                    <entity name="agentsubjects" dataSource="registry-ds"
                            query="SELECT label, term FROM subject WHERE id=${agents_subjects.subjects_id} AND label != 'keyword'">
                        <field column="label" name="subjectlabel"/>
                        <field column="term" name="subjectterm"/>
                    </entity>
                    <entity name="agentkeywords" dataSource="registry-ds"
                            query="SELECT term FROM subject WHERE id=${agents_subjects.subjects_id} AND label = 'keyword'">
                        <field column="term" name="subjectkeyword"/>
                    </entity>
                </entity>
            </entity>
        </entity>
        <entity name="service" dataSource="registry-ds"
                query="SELECT id, atomicnumber, published_id FROM service WHERE isactive = true AND published_id is not null">
            <field column="id" name="id"/>
            <field column="atomicnumber" name="atomicnumber"/>
            <entity name="serviceversion" dataSource="registry-ds"
                    query="SELECT title, description, type, id FROM serviceversion WHERE id=${service.published_id}">
                <field column="title" name="title"/>
                <field column="description" name="description"/>
                <field column="type" name="type"/>
                <entity name="services_subjects" dataSource="registry-ds"
                        query="SELECT * FROM services_subjects WHERE serviceversion_id=${serviceversion.id}">
                    <entity name="servicesubjects" dataSource="registry-ds"
                            query="SELECT label, term FROM subject WHERE id=${services_subjects.subjects_id} AND label != 'keyword'">
                        <field column="label" name="subjectlabel"/>
                        <field column="term" name="subjectterm"/>
                    </entity>
                    <entity name="servicekeywords" dataSource="registry-ds"
                            query="SELECT term FROM subject WHERE id=${services_subjects.subjects_id} AND label = 'keyword'">
                        <field column="term" name="subjectkeyword"/>
                    </entity>
                </entity>
            </entity>
        </entity>
        <entity name="activity" dataSource="registry-ds"
                query="SELECT id, atomicnumber, published_id FROM activity WHERE isactive = true AND published_id is not null">
            <field column="id" name="id"/>
            <field column="atomicnumber" name="atomicnumber"/>
            <entity name="activityversion" dataSource="registry-ds"
                    query="SELECT title, description, type, id FROM activityversion WHERE id=${activity.published_id}">
                <field column="title" name="title"/>
                <field column="description" name="description"/>
                <field column="type" name="type"/>
                <entity name="activities_subjects" dataSource="registry-ds"
                        query="SELECT * FROM activities_subjects WHERE activityversion_id=${activityversion.id}">
                    <entity name="activitiessubjects" dataSource="registry-ds"
                            query="SELECT label, term FROM subject WHERE id=${activities_subjects.subjects_id} AND label != 'keyword'">
                        <field column="label" name="subjectlabel"/>
                        <field column="term" name="subjectterm"/>
                    </entity>
                    <entity name="activitieskeywords" dataSource="registry-ds"
                            query="SELECT term FROM subject WHERE id=${activities_subjects.subjects_id} AND label = 'keyword'">
                        <field column="term" name="subjectkeyword"/>
                    </entity>
                </entity>
            </entity>
        </entity>
    </document>
</dataConfig>